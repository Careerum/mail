humhub.module("mail.notification",(function(e,n,t){var o=n("client"),a=n("ui.loader"),s=n("event"),i=n("ui.widget").Widget;const l=n("mail.conversationDummy");var u;e.initOnPjaxLoad=!0;var r=function(){o.get(e.config.url.count).then((function(e){d(parseInt(e.newMessages))}))},d=function(e){var n=t("#badge-messages");e&&"0"!=e?(n.empty(),n.append(e),n.fadeIn("fast")):n.css("display","none")};e.export({init:function(n){n||(s.on("humhub:modules:mail:live:NewUserMessage",(function(e,n){s=n[n.length-1],d(s.data.count)})).on("humhub:modules:mail:live:UserMessageDeleted",(function(e,n){s=n[n.length-1],d(s.data.count)})),t("#icon-messages").click((function(){u&&u.abort(),t("#loader_messages").parent().find(":not(#loader_messages)").remove(),a.set(t("#loader_messages").show()),o.get(e.config.url.list,{beforeSend:function(e){u=e}}).then((function(e){u=void 0,t("#loader_messages").parent().prepend(t(e.html)),t("#loader_messages").hide()}))}))),r()},loadMessage:function(e){t("#mail-conversation-root").length?(i.instance("#mail-conversation-root").loadMessage(e),l.hide()):o.redirect(e.url),e.finish()},setMailMessageCount:d,updateCount:r})}));